<!DOCTYPE html>
<html>
<head>
  <script src="jsPsych/jspsych.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <script src="jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych/plugins/jspsych-xab-html.js"></script>
  <script src="jsPsych/plugins/jspsych-xab-image.js"></script>

  <link rel="stylesheet" href="jsPsych/css/jspsych.css"></link>
  <style>
    img {
      width: 400px;
      }
    #jspsych-xab-stimulus{
      display: inline;
    }
  </style>
</head>
<body></body>
<script>

  /*style it they way I want it*/
  $(document.body).css("background-color", "black");
  $(document.body).css("color", "white");


  function createCircle(value, value2){
    var canvas = document.createElement('canvas');

    canvas.width = 400;
    canvas.height = 400;

    var ctx = canvas.getContext("2d");
    ctx.fillStyle = "black";
    ctx.fillRect(0,0, canvas.width, canvas.height);

    ctx.beginPath();
    ctx.arc(200, 200, 180, 0 , 2*Math.PI);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 5;
    ctx.stroke();

    ctx.font = "30pt Arial";
    ctx.textAlign = "center";

    if (arguments.length == 1){
      if(value == 0){
        ctx.fillStyle = "white";
        ctx.fillText("$0", 200,215);
      } else if(value < 0){
        ctx.fillStyle = "red";
        ctx.fillText("LOSE", 200, 195);
        ctx.fillText("-$" + String(-value), 200, 235);
      } else{
        ctx.fillStyle = "green";
        ctx.fillText("WIN", 200, 195)
        ctx.fillText("+$" + String(value), 200, 235);
      }
      dataURL = canvas.toDataURL();
      return "<img src=\"" + dataURL + "\">";

    } else if(arguments.length == 2){
        var counterbalence = Math.round(Math.random());
        var left = (counterbalence ? value2 : value);
        var right = (counterbalence ? value : value2);
        ctx.beginPath();
        ctx.moveTo(200, 20);
        ctx.lineTo(200, 380);
        ctx.stroke();

        if(left == 0){
          ctx.fillStyle = "white";
          ctx.fillText("$0", 110, 215);
        } else if(left < 0){
          ctx.fillStyle = "red";
          ctx.fillText("LOSE", 110, 195)
          ctx.fillText("-$" + String(-left), 110, 235);
        } else{
          ctx.fillStyle = "green";
          ctx.fillText("WIN", 110, 195)
          ctx.fillText("+$" + String(left), 110, 235);
        }

        if(right == 0){
          ctx.fillStyle = "white";
          ctx.fillText("$0", 290, 215);
        } else if(right < 0){
          ctx.fillStyle = "red";
          ctx.fillText("LOSE", 290, 195);
          ctx.fillText("-$" + String(-right), 290, 235);
        } else{
          ctx.fillStyle = "green";
          ctx.fillText("LOSE", 290, 195);
          ctx.fillText("+$" + String(right), 290, 235);
        }

      dataURL = canvas.toDataURL();
      return "<img src=\"" + dataURL + "\">";
    }
  }



  var trial_1 = {
    type: 'html-keyboard-response',
    stimulus: createCircle(-2.2, 0),
    choices: ['p'],
    prompt: '<p>Press p to continue</p>'
  }

  var trial_2 = {
    type: 'xab-image',
    stimuli: ["img/stim1.jpg", "img/stim1.jpg"],
    x_duration: 0,
    x_durationab_gap: 0
    //prompt: '<p>Press q or p to choose</p>'
  }

  var win = 5.6;
  var lose = -5.6;
  var sure = 0;
  var gamble_side = "R";

  var trial_3 = {
    type: 'xab-html',
    stimuli: (gamble_side == "R" ? [createCircle(win, lose), createCircle(sure)] : [createCircle(sure), createCircle(win, lose)]),
    x_duration: 0,
    x_durationab_gap: 0,
    data: {win:win, lose:lose, sure:sure, gamble: "R"}
  }

  jsPsych.init({
    timeline: [trial_1, trial_2, trial_3],
    on_finish: function() {
      jsPsych.data.displayData();
    },
    default_iti: 250
  });
</script>

</html>
